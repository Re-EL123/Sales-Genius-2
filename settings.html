<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sales Genius - Settings</title>
<link rel="stylesheet" href="css/style.css">
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#e0f7ff; transition: background 0.3s, color 0.3s; }
header { background:#00bfff; color:white; padding:15px; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; font-size:24px; }
header a { color:white; text-decoration:none; font-weight:bold; }
main { max-width:600px; margin:auto; padding:20px; display:flex; flex-direction:column; gap:20px; }
.settings-box { background:white; padding:20px; border-radius:12px; box-shadow:0 2px 12px rgba(0,0,0,0.2); display:flex; flex-direction:column; gap:15px; }
.settings-box h2 { margin:0; color:#00bfff; }
.settings-box label { font-weight:bold; margin-bottom:5px; }
.settings-box input, .settings-box select { padding:10px; border-radius:5px; border:1px solid #ccc; width:100%; }
.settings-box button { padding:10px; border:none; border-radius:5px; background:#00bfff; color:white; font-weight:bold; cursor:pointer; transition:0.3s; }
.settings-box button:hover { background:#009acd; transform:scale(1.05); }
</style>
</head>
<body>
<header>
    <h1>Settings</h1>
    <a href="dashboard.html">Back</a>
</header>

<main>
    <!-- Update Account Info -->
    <div class="settings-box">
        <h2>Account Information</h2>
        <label for="username">Username</label>
        <input type="text" id="username" placeholder="Enter your username">
        <label for="email">Email</label>
        <input type="email" id="email" placeholder="Enter your email">
        <label for="role">Select Role</label>
        <select id="role">
            <option value="cashier">Cashier</option>
            <option value="manager">Manager</option>
        </select>
        <button id="update-account">Update Account</button>
    </div>

    <!-- Change Password -->
    <div class="settings-box">
        <h2>Change Password</h2>
        <label for="current-password">Current Password</label>
        <input type="password" id="current-password" placeholder="Current Password">
        <label for="new-password">New Password</label>
        <input type="password" id="new-password" placeholder="New Password">
        <button id="change-password">Change Password</button>
    </div>

    <!-- Theme Preference -->
    <div class="settings-box">
        <h2>Theme Preference</h2>
        <label for="theme-select">Select Theme</label>
        <select id="theme-select">
            <option value="skyblue">Sky Blue</option>
            <option value="light">Light</option>
            <option value="dark">Dark</option>
        </select>
        <button id="save-theme">Save Theme</button>
    </div>
</main>

<script type="module">
// -------------------- FIREBASE CONFIG --------------------
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged, updatePassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBLD-z9z2Le8DAqYobMkd2kwurgI9B69rY",
  authDomain: "sales-genius-a.firebaseapp.com",
  projectId: "sales-genius-a",
  storageBucket: "sales-genius-a.firebasestorage.app",
  messagingSenderId: "443916526137",
  appId: "1:443916526137:web:87f76fa73b0a578b17a3e8",
  measurementId: "G-M9C615D3J5"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// -------------------- AUTH CHECK --------------------
onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "index.html";
  } else {
    loadUserData(user);
  }
});

// -------------------- LOCAL USER DATA --------------------
function loadUserData(user) {
  const savedUser = JSON.parse(localStorage.getItem('currentUser')) || {};
  document.getElementById('username').value = savedUser.username || user.displayName || '';
  document.getElementById('email').value = savedUser.email || user.email || '';
  document.getElementById('role').value = savedUser.role || 'cashier';

  const savedTheme = localStorage.getItem('theme') || 'skyblue';
  document.getElementById('theme-select').value = savedTheme;
  applyTheme(savedTheme);
}

// -------------------- ACCOUNT UPDATE --------------------
document.getElementById('update-account').addEventListener('click', () => {
  const updatedUser = {
    username: document.getElementById('username').value,
    email: document.getElementById('email').value,
    role: document.getElementById('role').value
  };
  localStorage.setItem('currentUser', JSON.stringify(updatedUser));
  alert('Account information updated!');
});

// -------------------- PASSWORD CHANGE --------------------
document.getElementById('change-password').addEventListener('click', async () => {
  const currentPass = document.getElementById('current-password').value;
  const newPass = document.getElementById('new-password').value;
  const user = auth.currentUser;

  if (!user) {
    alert('User not signed in!');
    return;
  }

  try {
    await updatePassword(user, newPass);
    alert('Password changed successfully!');
    document.getElementById('current-password').value = '';
    document.getElementById('new-password').value = '';
  } catch (error) {
    alert('Error updating password: ' + error.message);
  }
});

// -------------------- THEME HANDLING --------------------
const themeSelect = document.getElementById('theme-select');
themeSelect.addEventListener('change', () => applyTheme(themeSelect.value));

document.getElementById('save-theme').addEventListener('click', () => {
  const theme = themeSelect.value;
  localStorage.setItem('theme', theme);
  alert('Theme saved!');
});

function applyTheme(theme) {
  document.body.style.background =
    theme === 'skyblue' ? '#e0f7ff' :
    theme === 'light' ? '#f9f9f9' :
    '#1a1a1a';
  document.body.style.color = theme === 'dark' ? 'white' : 'black';
}
</script>
</body>
</html>
